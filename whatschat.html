<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What'sChat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
</head>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    text-align: center;
    padding: 20px;
}

.container {
    max-width: 600px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

h1 {
    color: #333;
}

p {
    color: #555;
}

.button {
    display: inline-block;
    margin: 10px;
    padding: 10px 20px;
    color: #fff;
    background-color: #007BFF;
    text-decoration: none;
    border-radius: 5px;
}

.button:hover {
    background-color: #0056b3;
}

input, textarea, button {
    display: block;
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
}

button {
    background-color: #28a745;
    color: #fff;
    border: none;
    border-radius: 5px;
}

button:hover {
    background-color: #218838;
}
</style>
<body>


    <div class="container">
        <h1>Welcome to What'sChat</h1>
        <!-- Room Selection -->
        <h2>Select or Create a Room:</h2>
        <input type="text" id="room-name" placeholder="Enter Room Name">
        <button onclick="joinRoom()">Join Room</button>
        <!-- Chat Interface -->
        <div id="chat-interface" style="display: none;">
            <h2>Room: <span id="room-title"></span></h2>
            <div id="chat-box" style="border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; text-align:center;"></div>
            <input type="text" id="chat-message" placeholder="Type your message">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
    <script>
        const socket = io();
        let currentRoom = '';
        let username = '';

        // Join a chat room
        function joinRoom() {
            const roomName = document.getElementById('room-name').value;
            username = prompt("Enter your username:");
            if (!roomName || !username) {
                alert("Room name and username are required!");
                return;
            }
            currentRoom = roomName;
            socket.emit('join_room', { room: roomName, username });
            // Show chat interface
            document.getElementById('room-title').textContent = roomName;
            document.getElementById('chat-interface').style.display = 'block';
        }

        // Listen for new user join
        socket.on('user_joined', (data) => {
            if (data.room === currentRoom) {
                const chatBox = document.getElementById('chat-box');
                const message = `${data.users[data.users.length - 1]} joined the room.`;
                const p = document.createElement('p');
                p.textContent = message;
                chatBox.appendChild(p);
                chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to the latest message
            }
        });

        // Send message to the server
        function sendMessage() {
            const message = document.getElementById('chat-message').value;
            if (!message) {
                alert("Message cannot be empty!");
                return;
            }
            socket.emit('send_message', { room: currentRoom, message, username });
            document.getElementById('chat-message').value = ''; // Clear input box
        }

        // Receive new messages from the server
        socket.on('new_message', (data) => {
            const chatBox = document.getElementById('chat-box');
            const p = document.createElement('p');
            p.textContent = `${data.username}: ${data.message}`;
            chatBox.appendChild(p);
            chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to the latest message
        });
    </script>
</body>
</html>
